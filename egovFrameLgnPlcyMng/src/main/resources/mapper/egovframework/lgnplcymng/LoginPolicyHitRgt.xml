<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.lpmg.dao.LoginPolicyHitRegisterDao">

    <select id="selectHitRgstList" resultType="hashMap">
			SELECT a.USR_ID
			     , a.POLICY_ID
			     , ifnull(b.POLICY_NM,'-미등록정책-') AS POLICY_NM 
			     , COUNT(*) CNT
			  FROM COMTNLOGINPOLICYHITHISTORY a
			  	   LEFT OUTER JOIN
			        COMTNLOGINPOLICY b
			       ON (a.POLICY_ID  = b.POLICY_ID) 
			 GROUP BY a.USR_ID, a.POLICY_ID
    </select>


    <select id="selectHitRgstUser"  parameterType="Map" resultType="hashMap">
			SELECT a.USR_ID 
			     , a.POLICY_ID 
			     , ifnull(b.POLICY_NM,'-미등록정책-') AS POLICY_NM
			     , COUNT(*) CNT 
			  FROM COMTNLOGINPOLICYHITHISTORY a 
			       LEFT OUTER JOIN 
			       COMTNLOGINPOLICY b 
			    ON (a.POLICY_ID = b.POLICY_ID) 
			 WHERE a.USR_ID = '${USRID}'
			 GROUP BY a.USR_ID, a.POLICY_ID
    </select>

    <insert id="insertLgPlcyHitRgst" parameterType="hashMap">
			INSERT INTO COMTNLOGINPOLICYHITHISTORY (
				   USR_ID
				 , POLICY_ID 
				 , POLICY_HIT_DT 
				 , LOGIN_IP 
			) VALUES (
				  #{USRID}
				, #{PLCYID}
				, DATE_FORMAT(NOW(6), '%Y%m%d%H%i%s%f')
				, #{LGINIP}
 			)
    </insert>
    
    <delete id="deleteLgPlcyHitUsrRgst" parameterType="hashMap">
			DELETE FROM COMTNLOGINPOLICYHITHISTORY
			 WHERE USR_ID = '${USRID}'
    </delete>

    <delete id="deleteLgPlcyHitPlcyRgst" parameterType="hashMap">
			DELETE FROM COMTNLOGINPOLICYHITHISTORY
			 WHERE POLICY_ID = '${PLCYID}'
    </delete>
    
    <select id="selectLgPlcyHitlMsg"  parameterType="Map" resultType="hashMap">
			SELECT a.USR_ID 
			     , a.POLICY_ID 
			     , ifnull(b.POLICY_NM,'-미등록정책-') AS POLICY_NM
			     , COUNT(*) CNT 
			  FROM COMTNLOGINPOLICYHITHISTORY a 
			       LEFT OUTER JOIN 
			       COMTNLOGINPOLICY b 
			    ON (a.POLICY_ID = b.POLICY_ID) 
			 WHERE a.USR_ID = '${USRID}'
			 GROUP BY a.USR_ID, a.POLICY_ID
    </select>

</mapper> 